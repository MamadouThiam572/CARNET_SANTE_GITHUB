<html th:replace="~{layout :: layout(~{::section}, ~{::script})}" xmlns:th="http://www.thymeleaf.org">
<section class="space-y-6 animate-in slide-in-from-bottom-5 duration-500">
    <div class="flex items-center justify-between">
        <h2 class="text-3xl font-black text-gray-900 tracking-tight">Ajouter un Membre</h2>
        <a th:href="@{/profiles}"
            class="bg-gray-100 text-gray-500 p-3 rounded-2xl shadow-sm active:scale-95 transition-all">
            Retour
        </a>
    </div>

    <!-- Progress Bar -->
    <div class="flex gap-2 mb-6">
        <div id="step-bar-1" class="h-2 flex-1 bg-emerald-500 rounded-full transition-all"></div>
        <div id="step-bar-2" class="h-2 flex-1 bg-gray-200 rounded-full transition-all"></div>
        <div id="step-bar-3" class="h-2 flex-1 bg-gray-200 rounded-full transition-all"></div>
    </div>

    <form th:action="@{/profiles/add}" method="POST"
        class="bg-white p-6 rounded-[2.5rem] shadow-sm border-2 border-gray-50 min-h-[400px] flex flex-col justify-between relative overflow-hidden">

        <!-- Step 1: Identité -->
        <div id="step-1" class="step-content space-y-5">
            <h3 class="text-xl font-black text-gray-800">1. Qui ajoutez-vous ?</h3>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Lien de parenté</label>
                <select name="relation"
                    class="w-full p-5 bg-emerald-50 border-2 border-emerald-100 rounded-[1.5rem] focus:border-emerald-500 outline-none font-black text-emerald-900 appearance-none">
                    <option value="">Sélectionner...</option>
                    <option value="Enfant">Enfant</option>
                    <option value="Conjoint">Conjoint(e)</option>
                    <option value="Parent">Parent</option>
                    <option value="Frère/Soeur">Frère / Sœur</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Prénom</label>
                <input type="text" name="firstName" placeholder="Prénom" required
                    class="w-full p-5 bg-emerald-50 border-2 border-emerald-100 rounded-[1.5rem] focus:border-emerald-500 outline-none font-black text-emerald-900 placeholder-emerald-300 text-lg">
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Nom</label>
                <input type="text" name="lastName" placeholder="Nom de famille" required
                    class="w-full p-5 bg-gray-50 border-2 border-gray-100 rounded-[1.5rem] focus:border-emerald-500 outline-none font-bold text-lg">
            </div>
        </div>

        <!-- Step 2: Détails -->
        <div id="step-2" class="step-content space-y-5 hidden">
            <h3 class="text-xl font-black text-gray-800">2. Quelques détails</h3>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Date de Naissance</label>
                <input type="date" name="birthDate" required
                    class="w-full p-5 bg-gray-50 border-2 border-gray-100 rounded-[1.5rem] focus:border-emerald-500 outline-none font-bold text-lg">
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Sexe</label>
                <div class="flex gap-3">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="gender" value="M" class="peer hidden" required>
                        <div
                            class="bg-gray-50 p-4 rounded-[1.5rem] border-2 border-gray-100 text-center peer-checked:bg-emerald-50 peer-checked:border-emerald-500 peer-checked:text-emerald-700 font-bold transition-all">
                            Homme
                        </div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="gender" value="F" class="peer hidden">
                        <div
                            class="bg-gray-50 p-4 rounded-[1.5rem] border-2 border-gray-100 text-center peer-checked:bg-emerald-50 peer-checked:border-emerald-500 peer-checked:text-emerald-700 font-bold transition-all">
                            Femme
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Step 3: Médical -->
        <div id="step-3" class="step-content space-y-5 hidden">
            <h3 class="text-xl font-black text-gray-800">3. Infos Médicales</h3>
            <p class="text-sm text-gray-500">Ces informations sont optionnelles mais utiles.</p>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Groupe Sanguin</label>
                <select name="bloodGroup"
                    class="w-full p-5 bg-gray-50 border-2 border-gray-100 rounded-[1.5rem] focus:border-emerald-500 outline-none font-bold appearance-none">
                    <option value="">Je ne sais pas</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-400 uppercase mb-2 ml-2">Allergies / Remarques</label>
                <textarea name="allergies" placeholder="Ex: Arachides, Pénicilline..."
                    class="w-full p-5 bg-gray-50 border-2 border-gray-100 rounded-[1.5rem] focus:border-emerald-500 outline-none font-bold min-h-[100px]"></textarea>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex gap-3 mt-8 pt-4 border-t border-gray-100">
            <button type="button" id="prevBtn" onclick="prevStep()"
                class="hidden px-6 py-4 bg-gray-100 text-gray-600 rounded-2xl font-bold active:scale-95 transition-all">Retour</button>
            <button type="button" id="nextBtn" onclick="nextStep()"
                class="flex-1 px-6 py-4 bg-emerald-600 text-white rounded-2xl font-black text-lg shadow-lg shadow-emerald-200 active:scale-95 transition-all">Continuer</button>
            <button type="submit" id="submitBtn"
                class="hidden flex-1 px-6 py-4 bg-emerald-600 text-white rounded-2xl font-black text-lg shadow-lg shadow-emerald-200 active:scale-95 transition-all">Terminer</button>
        </div>
    </form>
</section>

<script>
    let currentStep = 1;
    const totalSteps = 3;

    function updateUI() {
        // Steps visibility
        document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
        document.getElementById(`step-${currentStep}`).classList.remove('hidden');

        // Buttons
        document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);

        if (currentStep === totalSteps) {
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('submitBtn').classList.remove('hidden');
        } else {
            document.getElementById('nextBtn').classList.remove('hidden');
            document.getElementById('submitBtn').classList.add('hidden');
        }

        // Progress Bar
        for (let i = 1; i <= totalSteps; i++) {
            const bar = document.getElementById(`step-bar-${i}`);
            if (i <= currentStep) {
                bar.classList.remove('bg-gray-200');
                bar.classList.add('bg-emerald-500');
            } else {
                bar.classList.add('bg-gray-200');
                bar.classList.remove('bg-emerald-500');
            }
        }
    }

    function nextStep() {
        if (!validateStep(currentStep)) return;
        if (currentStep < totalSteps) {
            currentStep++;
            updateUI();
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            currentStep--;
            updateUI();
        }
    }

    function validateStep(step) {
        if (step === 1) {
            const first = document.querySelector('input[name="firstName"]').value;
            const last = document.querySelector('input[name="lastName"]').value;
            if (!first || !last) {
                alert("Veuillez remplir les noms.");
                return false;
            }
        }
        if (step === 2) {
            const dob = document.querySelector('input[name="birthDate"]').value;
            const gender = document.querySelector('input[name="gender"]:checked');
            if (!dob || !gender) {
                alert("Veuillez remplir la date et le sexe.");
                return false;
            }
        }
        return true;
    }
</script>

</html>